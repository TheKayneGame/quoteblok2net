@page "/profile"

@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Authentication.OAuth.Claims
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using System.Text.Json
@using System.Net.Http
@using System.Net.Http.Json
@using System.Net.Http.Headers;
@using quoteblok2net.quotes;

@inject IHttpContextAccessor httpContextAccessor
@inject HttpClient httpClient
@inject NavigationManager Navigator
@inject IQuoteManager manager
@inject DiscordManager discordManager 


<AuthorizeView>
    <Authorized>
        <h1>Hello @context.User.Identity.Name</h1>
        <br>
        <h2>Your Blok2Bot Enabled Servers:</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>ID</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (Guild guild in Guilds)
                {
                    <tr>
                        <td>@guild.Name</td>
                        <td>@guild.Id</td>
                        <td>
                            <form action="/quotes/@guild.Id">
                                <input class="btn btn-primary" type="submit" value="View" />
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </Authorized>
    <NotAuthorized>
        <h1>BBBBB</h1>
    </NotAuthorized>
</AuthorizeView>

@code {


    public List<Guild> Guilds = new List<Guild>();

    protected override void OnInitialized()
    {
        Guilds = discordManager.GetGuilds();

    }
}